@model Message
<li class="floatContainer" id="msg@(Model.Id)">
	<div class="msgHeader">
		<strong>
			<a class="msgId" rel="nofollow"
				href="@(ViewData.Get<bool>("FullUrl", false) ? Url.Action(null, null, new{page=0}) : "")#msg@(Model.Id)" 
				onclick="window.location.hash='#msg@(Model.Id)';return false;">#@(Model.Id)</a>
		</strong>
		<span class="userSep">
		by
		</span>
		<strong class="userName">@Html.ActionLink(Model.User.UserName, "Detail", "Users", new{id=Model.User.Id}, new{rel="nofollow"})</strong>
		<span class="dateSep">
		 
		</span>
		@Html.Date(Model.Date)
	</div>
	<div class="msgBody">
	@if (this.Model.Active)
	{
		@Html.Raw(Model.Body)
	}
	else
	{
		<p class="removed">The message was removed by the forum moderator.</p>
	}
	</div>
	<div class="msgOptions">
		@Html.Link("link", (ViewData.Get<bool>("FullUrl", false) ? Url.Action(null, null, new{page=0}) : "") + "#msg" + Model.Id, new{@class="first"})
		@Html.ActionLink("reply", "Reply", new{msg=Model.Id}, new{rel="nofollow"})
		@if (this.User != null && this.User.Group >= UserGroup.Moderator && Model.Active)
		{
			@Html.Link("remove", "#", new{onclick="return deleteMessage(" + Model.Id + ");"})
		}
		@Html.Link("flag", "#", new{title="Mark as inappropriate", onclick="return flagMessage(" + Model.Id + ");"})
	</div>
	@*
	Add required js functions just once
	*@
	@if (Model.Id == 1)
	{
		<script type="text/javascript">
			function deleteMessage(mid)
			{
				if (confirm('Are you sure you want to hide the message #' + mid + '?'))
				{
					$.post('@Url.Action("Delete", "Messages")', { mid: mid }, function (data)
					{
						$("#msg" + mid + " > div.msgBody").html("<p class=\"removed\">Message removed</p>");
						alert('The message was removed.');
					});
				}
				return false;
			}
			function flagMessage(mid)
			{
				$.post('@Url.Action("Flag", "Messages")', { mid: mid }, function (data)
				{
					alert('Thanks you, a moderator will review the message.');
				});
				return false;
			}
		</script>
	}
</li>